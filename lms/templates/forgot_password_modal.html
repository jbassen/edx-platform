<%namespace name='static' file='static_content.html'/>

<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
%>

<section id="forgot-password-modal" class="modal" role="dialog" tabindex="-1" aria-label="${_('Password Reset')}">
  <div class="inner-wrapper">
    <button class="close-modal">
      <i class="icon fa fa-remove"></i>
      <span class="sr">
        ## Translators: this is a control to allow users to exit out of this modal interface (a menu or piece of UI that takes the full focus of the screen)
        ${_('Close')}
      </span>
    </button>

    <div id="password-reset">
      <header>
        <h2>${_("Password Reset")}</h2>
      </header>

      <div class="instructions">
        <p>${_("Please enter your e-mail address below, and we will e-mail instructions for setting a new password.")}</p>
      </div>

      <form action="${reverse('password_reset')}" method="post" data-remote="true">
        <div class="modal-form-error is-hidden">
            ${_("Email is incorrect.")}
        </div>
        <fieldset class="group group-form group-form-requiredinformation">
          <legend class="is-hidden">${_("Required Information")}</legend>

          <ol class="list-input">
            <li class="field required text" id="forgot-password-modal-field-email">
              <label for="pwd_reset_email">${_("Your E-mail Address")}</label>
              <input class="" id="pwd_reset_email" type="email" name="email" value="" placeholder="example: username@domain.com" aria-describedby="pwd_reset_email-tip" aria-required="true" />
              <span class="tip tip-input" id="pwd_reset_email-tip">${_("This is the e-mail address you used to register with {platform}").format(platform=static.get_platform_name())}</span>
            </li>
          </ol>
        </fieldset>

        <div class="form-actions">
          <button name="submit" type="submit" id="pwd_reset_button" class="action action-primary action-update">${_("Reset My Password")}</button>
        </div>
      </form>
    </div>
  </div>
</section>

<script type="text/javascript">
(function (window) {
    'use strict';
    var $ = window.$;
    var KEY_TAB = 9;
    var KEY_ESCAPE = 27;

    function preventDefault(event) {
        event.preventDefault();
    }
    function closeModal() {
        $("#forgot-password-modal").attr("aria-hidden", "true");
        $("#forgot-password-link").focus();
    }
    function bindKeyForTabIndex(selectorFrom, selectorTo) {
        $(selectorFrom).on('keydown', function handleKeyDown(event) {
            var keyCode = event.which;
            if (keyCode === KEY_TAB) {
                preventDefault(event);
                $(selectorTo).focus();
            }
        });
    }
    function handleEscapeFromModal(event) {
        var keyCode = event.which;
        if (keyCode === KEY_ESCAPE) {
            preventDefault(event);
            closeModal();
        }
    }

    $('#password-reset FORM').on('ajax:success', function (data, result, xhr) {
        if (result.success) {
            $("#password-reset").html(result.value);
        } else {
            $('#password-reset .modal-form-error').show();
        }
    });

    $('#login-modal .close-modal').click(preventDefault);
    $("#forgot-password-modal .close-modal").click(closeModal);
    $("#forgot-password-modal").on("keydown", handleEscapeFromModal);
    bindKeyForTabIndex("#forgot-password-modal .close-modal", "#pwd_reset_email");
    bindKeyForTabIndex("#pwd_reset_email", "#pwd_reset_button");
    bindKeyForTabIndex("#pwd_reset_button", "#forgot-password-modal .close-modal");
}(window));
</script>
